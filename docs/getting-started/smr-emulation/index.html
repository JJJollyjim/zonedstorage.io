<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Zoned Storage Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Zoned Storage Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0DX1KGD5E4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0DX1KGD5E4",{})</script><title data-react-helmet="true">Getting Started with Emulated SMR Hard-Disks | Zoned Storage</title><meta data-react-helmet="true" property="og:url" content="https://zonedstorage.io/docs/getting-started/smr-emulation"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Getting Started with Emulated SMR Hard-Disks | Zoned Storage"><meta data-react-helmet="true" name="description" content="Emulated ZBC disks make it possible to do application development and kernel"><meta data-react-helmet="true" property="og:description" content="Emulated ZBC disks make it possible to do application development and kernel"><link data-react-helmet="true" rel="shortcut icon" href="/img/zs-logo.ico"><link data-react-helmet="true" rel="canonical" href="https://zonedstorage.io/docs/getting-started/smr-emulation"><link data-react-helmet="true" rel="alternate" href="https://zonedstorage.io/docs/getting-started/smr-emulation" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zonedstorage.io/docs/getting-started/smr-emulation" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.30532e53.css">
<link rel="preload" href="/assets/js/runtime~main.18692684.js" as="script">
<link rel="preload" href="/assets/js/main.e827f9a4.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Zoned Storage</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/docs/community/support">Community</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Zoned Storage</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/introduction">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/support">Community</a></li><li class="menu__list-item"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><div class="docSidebarContainer_0YBq" role="complementary"><div class="sidebar_a3j0"><div class="menu menu--responsive thin-scrollbar menu_cyFh"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction/zoned-storage">Zoned Storage Devices</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction/smr">Shingled Magnetic Recording</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction/zns">NVMe Zoned Namespaces (ZNS) SSDs</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/prerequisites">System Prerequisites</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/nullblk">Zoned Block Device Emulation with nullblk</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/smr-disk">Getting Started with SMR Hard-Disks</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/getting-started/smr-emulation">Getting Started with Emulated SMR Hard-Disks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/zns-emulation">Getting Started with Emulated NVMe ZNS Devices</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Linux Kernel Support</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/overview">Linux Kernel Zoned Storage Support</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/config">Kernel Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/zbd-api">Zoned Block Device User Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/sched">Write Ordering Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/part">Zoned Block Device Partition Support</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/dm">Device Mapper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/fs">File Systems</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/applications">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/applications/percona-server">Percona Server for MySQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/applications/zenfs">RocksDB with ZenFS</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tools and Libraries</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/util-linux">Linux System Utilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/zns">ZNS Tools</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/sg3utils">SCSI Generic Utilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/libzbc">libzbc User Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/libzbd">libzbd User Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/libnvme">libnvme User Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/tcmu-runner">tcmu-runner ZBC Disk Emulation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/qemu">QEMU and KVM</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">System Compliance Tests</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tests">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tests/zbc-tests">ZBC/ZAC Compliance Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tests/blktests">Kernel Block Layer Tests</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/distributions/linux">Linux Distributions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/benchmarking/benchmark">Benchmarking Zoned Block Devices</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq/faq">Frequently Asked Questions</a></li></ul></div></div></div><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Getting Started with Emulated SMR Hard-Disks</h1></header><div class="markdown"><p>Emulated ZBC disks make it possible to do application development and kernel
tests even if you do not have access to ZBC or ZAC disks. There are several
ways to do this.</p><ul><li><p><strong><em>null_blk</em></strong>: The <em>null_blk</em> kernel driver makes it possible to emulate
zoned block devices.  This method is discussed in more detail in the
<a href="/docs/getting-started/nullblk">Zoned Block Device Emulation with null_blk</a> chapter of the
Getting Started Guide.</p></li><li><p><strong><em>tcmu-runner</em></strong>: This scsi device emulation application makes it possible
to use a regular file (as a storage backstore) to emulate both host-aware and
host-managed ZBC SCSI disks. The disks created using <em>tcmu-runner</em> function
like physical disks.</p></li><li><p><strong><em>scsi_debug</em></strong>: The <em>scsi_debug</em> kernel driver can be configured to emulate
host-aware and host-managed ZBC disks that appear to the kernel and
application exactly as a real disk would.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="tcmu-runner"></a><em>tcmu-runner</em><a class="hash-link" href="#tcmu-runner" title="Direct link to heading">#</a></h2><p>Detailed information on how to install and operate <em>tcmu-runner</em> can be found
in the <a href="/docs/tools/tcmu-runner">tcmu-runner ZBC Disk Emulation</a> chapter of
the <a href="/docs/tools">Tools and Libraries</a> Guide.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="tcmu-runner-zbc-file-handler"></a>tcmu-runner ZBC File Handler<a class="hash-link" href="#tcmu-runner-zbc-file-handler" title="Direct link to heading">#</a></h3><p>The <em>ZBC file handler</em> is an internal device handler of <em>tcmu-runner</em> that
emulates a ZBC SCSI disk and uses a file as a backstore. The <em>tcmu-runner</em>
infrastructure connects the emulated disk to a virtual HBA that has been
implemented as a kernel driver. This structure provides a command path for the
emulated disk that is identical to the command path that would be available if a
physical disk were in its place. Applications and kernel components will not
perceive any difference.</p><p>The <a href="/docs/tools/tcmu-runner">tcmu-runner ZBC Disk Emulation</a> chapter of the
<a href="/docs/tools">Tools and Libraries</a> guide describes in more
detail the options available for creating emulated disks. These include the disk
zone model, the disk zone size, the disk capacity, and the number of
conventional zones of the disk.</p><p>The following example shows how to create a small (20 GB) host-managed ZBC disk
that has 10 conventional zones and a 256 MiB zone size. In this example, the
emulated disk capacity is stored in the file <em>/var/local/zbc0.raw</em>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># targetcli</span></div><div class="token-line" style="color:#393A34"><span class="token plain">targetcli shell version 2.1.fb49</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Copyright 2011-2013 by Datera, Inc and others.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">For help on commands, type &#x27;help&#x27;.</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/&gt; cd /backstores/user:zbc</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/backstores/user:zbc&gt; create name=zbc0 size=20G cfgstring=model-HM/zsize-256/conv-10@/var/local/zbc0.raw</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Created user-backed storage object zbc0 size 21474836480.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/backstores/user:zbc&gt; cd /loopback</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/loopback&gt; create</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Created target naa.500140529100d742.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/loopback&gt; cd naa.500140529100d742/luns</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/loopback/naa...9100d742/luns&gt; create /backstores/user:zbc/zbc0 0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Created LUN 0.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/loopback/naa...9100d742/luns&gt; cd /</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/&gt; ls</span></div><div class="token-line" style="color:#393A34"><span class="token plain">o- / ..................................................................... [...]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  o- backstores .......................................................... [...]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  | o- block .............................................. [Storage Objects: 0]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  | o- fileio ............................................. [Storage Objects: 0]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  | o- pscsi .............................................. [Storage Objects: 0]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  | o- ramdisk ............................................ [Storage Objects: 0]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  | o- user:fbo ........................................... [Storage Objects: 0]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  | o- user:poma .......................................... [Storage Objects: 0]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  | o- user:zbc ........................................... [Storage Objects: 1]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  |   o- zbc0  [model-HM/zsize-256/conv-10@/var/local/zbc0.raw (20.0GiB) activated]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  |     o- alua ............................................... [ALUA Groups: 1]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  |       o- default_tg_pt_gp ................... [ALUA state: Active/optimized]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  o- iscsi ........................................................ [Targets: 0]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  o- loopback ..................................................... [Targets: 1]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  | o- naa.500140529100d742 ............................. [naa.50014059e05d5424]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  |   o- luns ........................................................ [LUNs: 1]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  |     o- lun0 ................................. [user/zbc0 (default_tg_pt_gp)]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  o- vhost ........................................................ [Targets: 0]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/&gt; exit</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="verifying-the-emulated-disk"></a>Verifying The Emulated Disk<a class="hash-link" href="#verifying-the-emulated-disk" title="Direct link to heading">#</a></h3><p>You can verify that the emulated disk has been identified and initialized by
the kernel in the same way that you verify the kernel identification and
initialization of Serial ATA disks and SAS disks, as discussed in the <a href="/docs/getting-started/smr-disk">Getting
started with an SMR disk</a> chapter.</p><p>Identify the emulated disk by looking at the disk vendor ID that is displayed
by the <em>lsscsi</em> utility:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># lsscsi -g</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[2:0:0:0]    disk    ATA      INTEL SSDSC2CT18 335u  /dev/sda   /dev/sg0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[5:0:0:0]    zbc     ATA      HGST HSH721415AL T220  /dev/sdb   /dev/sg1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[11:0:1:0]   zbc     LIO-ORG  TCMU ZBC device  0002  /dev/sdc   /dev/sg2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>In this example, the emulated disk is listed with the device vendor name
&quot;LIO-ORG&quot; and the device model name is &quot;TCMU ZBC device&quot;.</p><p>As with physical ZBC and ZAC disks, the kernel messages will show that the
drive has been identified and initialized:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># dmesg</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">scsi host11: TCM_Loopback</span></div><div class="token-line" style="color:#393A34"><span class="token plain">scsi 11:0:1:0: Direct-Access-ZBC LIO-ORG  TCMU ZBC device  0002 PQ: 0 ANSI: 5</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:1:0: Attached scsi generic sg2 type 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:1:0: [sdc] Host-managed zoned block device</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:1:0: [sdc] 41943040 512-byte logical blocks: (21.5 GB/20.0 GiB)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:1:0: [sdc] 80 zones of 524288 logical blocks</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:1:0: [sdc] Write Protect is off</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:1:0: [sdc] Mode Sense: 0f 00 00 00</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:1:0: [sdc] Write cache: enabled, read cache: enabled, doesn&#x27;t support DPO or FUA</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:1:0: [sdc] Optimal transfer size 65536 bytes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:1:0: [sdc] Attached SCSI disk</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The kernel identifies the emulated disk in the same way that it would identify
a physical SAS host managed disk (that is, with the device type
&quot;<em>Direct-Access-ZBC</em>&quot;).</p><p>The emulated disk can now be used in the same manner as any physical disk. For
instance, the <em>blkzone</em> or <em>zbc_report_zones</em> utilities can be used to inspect
the disk zone configuration:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones /dev/sdc</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sdc:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: LIO-ORG TCMU ZBC device 0002</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Zoned block device interface, Host-managed zone model</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    41943040 512-bytes sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    41943040 logical blocks of 512 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    41943040 physical blocks of 512 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    21.475 GB capacity</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 35</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    80 zones from 0, reporting option 0x00</span></div><div class="token-line" style="color:#393A34"><span class="token plain">80 / 80 zones:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00000: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 0, 524288 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00001: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 524288, 524288 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00002: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 1048576, 524288 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00003: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 1572864, 524288 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00004: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 2097152, 524288 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00005: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 2621440, 524288 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00006: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 3145728, 524288 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00007: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 3670016, 524288 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00008: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 4194304, 524288 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00009: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 4718592, 524288 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00010: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 5242880, 524288 sectors, wp 5242880</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00011: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 5767168, 524288 sectors, wp 5767168</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00078: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 40894464, 524288 sectors, wp 40894464</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00079: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 41418752, 524288 sectors, wp 41418752</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="scsi_debug"></a><em>scsi_debug</em><a class="hash-link" href="#scsi_debug" title="Direct link to heading">#</a></h2><p>The <em>scsi_debug</em> kernel module can be used to create emulated ZBC SCSI disks
that use memory backing to store data, which is written to sectors.
Because this method uses memory as a backing store, the creation of large disks
requires a host with a large amount of DRAM.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>This method stores sector data using volatile memory. This means that the data
written to the emulated device will not survive the device&#x27;s destruction and the
data written to this emulated device will not survive a host reboot.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="creating-an-emulated-zbc-disk"></a>Creating an Emulated ZBC Disk<a class="hash-link" href="#creating-an-emulated-zbc-disk" title="Direct link to heading">#</a></h3><p><em>scsi_debug</em> ZBC disks can be created using <em>modprobe</em> with arguments.  The
following is an example that creates a host managed ZBC disk with 16GiB
capacity, 64MiB zones, and 32 conventional zones.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># modprobe scsi_debug \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    max_luns=1 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    sector_size=4096 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    dev_size_mb=16384 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    zbc=managed \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    zone_size_mb=64 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    zone_nr_conv=32</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>After the disk has been created, it can be examined by using the <em>lsscsi</em>
command.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># lsscsi -g</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[11:0:0:0]   zbc     Linux    scsi_debug       0190  /dev/sdj   /dev/sg9</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The vendor field of the disk is set to &quot;scsi_debug&quot;. The kernel messages
also show the process whereby this disk came online.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># dmesg</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">scsi_debug:sdebug_driver_probe: scsi_debug: trim poll_queues to 0. poll_q/nr_hw = (0/1)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">scsi host11: scsi_debug: version 0190 [20200710]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                 dev_size_mb=16384, opts=0x0, submit_queues=1, statistics=0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">scsi 11:0:0:0: Direct-Access-ZBC Linux    scsi_debug       0190 PQ: 0 ANSI: 7</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:0:0: Power-on or device reset occurred</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:0:0: Attached scsi generic sg9 type 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:0:0: [sdj] Host-managed zoned block device</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:0:0: [sdj] 4194304 4096-byte logical blocks: (17.2 GB/16.0 GiB)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:0:0: [sdj] Write Protect is off</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:0:0: [sdj] Mode Sense: 5b 00 10 08</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:0:0: [sdj] Write cache: enabled, read cache: enabled, supports DPO and FUA</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:0:0: [sdj] Optimal transfer size 4194304 bytes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:0:0: [sdj] 256 zones of 16384 logical blocks</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sd 11:0:0:0: [sdj] Attached SCSI disk</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="verifying-the-emulated-disk-1"></a>Verifying The Emulated Disk<a class="hash-link" href="#verifying-the-emulated-disk-1" title="Direct link to heading">#</a></h3><p>The zone configuration of the emulated disk can be inspected by using
<a href="/docs/tools/libzbc"><em>libzbc</em></a>, <a href="/docs/tools/sg3utils"><em>sg3utils</em></a> and
<a href="/docs/tools/util-linux"><em>util-linux</em></a> tools.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="using-zbc_report_zones"></a>Using zbc_report_zones<a class="hash-link" href="#using-zbc_report_zones" title="Direct link to heading">#</a></h4><p>Use <a href="/docs/tools/libzbc#zone-information"><em>zbc_report_zones</em></a> to verify the
zone configuration of the newly-created emulated ZBC disk:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones /dev/sg9</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sg9:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: Linux scsi_debug 0190</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    SCSI ZBC device interface, Host-managed zone model</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    33554432 512-bytes sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    4194304 logical blocks of 4096 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    4194304 physical blocks of 4096 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    17.180 GB capacity</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    4096 KiB max R/W size</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    256 zones from 0, reporting option 0x00</span></div><div class="token-line" style="color:#393A34"><span class="token plain">256 / 256 zones:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00000: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 0, 131072 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00001: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 131072, 131072 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00002: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 262144, 131072 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00031: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 4063232, 131072 sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00032: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 4194304, 131072 sectors, wp 4194304</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00033: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 4325376, 131072 sectors, wp 4325376</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00254: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 33292288, 131072 sectors, wp 33292288</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00255: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 33423360, 131072 sectors, wp 33423360</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="using-blkzone"></a>Using blkzone<a class="hash-link" href="#using-blkzone" title="Direct link to heading">#</a></h4><p>Use <a href="/docs/tools/util-linux#zone-report"><em>blkzone</em></a> to verify the zone
configuration of the newly-created emulated ZBC disk. This displays the same
information that is returned by &quot;zbc_report_zones&quot;, but it is displayed in a
different format:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># blkzone report /dev/sdj</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  start: 0x000000000, len 0x020000, cap 0x020000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  start: 0x000020000, len 0x020000, cap 0x020000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  start: 0x000040000, len 0x020000, cap 0x020000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  start: 0x0003e0000, len 0x020000, cap 0x020000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  start: 0x000400000, len 0x020000, cap 0x020000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  start: 0x000420000, len 0x020000, cap 0x020000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  start: 0x001fc0000, len 0x020000, cap 0x020000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  start: 0x001fe0000, len 0x020000, cap 0x020000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/getting-started/smr-disk"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Getting Started with SMR Hard-Disks</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/getting-started/zns-emulation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Getting Started with Emulated NVMe ZNS Devices Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tcmu-runner" class="table-of-contents__link"><em>tcmu-runner</em></a><ul><li><a href="#tcmu-runner-zbc-file-handler" class="table-of-contents__link">tcmu-runner ZBC File Handler</a></li><li><a href="#verifying-the-emulated-disk" class="table-of-contents__link">Verifying The Emulated Disk</a></li></ul></li><li><a href="#scsi_debug" class="table-of-contents__link"><em>scsi_debug</em></a><ul><li><a href="#creating-an-emulated-zbc-disk" class="table-of-contents__link">Creating an Emulated ZBC Disk</a></li><li><a href="#verifying-the-emulated-disk-1" class="table-of-contents__link">Verifying The Emulated Disk</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/zoned-storage">Introduction to Zoned Storage</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started with Zoned Storage</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://app.element.io/#/room/#zonedstorage-general:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix</a></li><li class="footer__item"><a href="https://join.slack.com/t/zonedstorage/shared_invite/zt-uyfut5xe-nKajp9YRnEWqiD4X6RkTFw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://webchat.oftc.net/?channels=zonedstorage" target="_blank" rel="noopener noreferrer" class="footer__link-item">IRC @ OFTC</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/westerndigitalcorporation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Organization</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Western Digital
	Corporation or its affiliates. All rights reserved.<br> By using this site, you agree to the <a href="https://www.westerndigital.com/legal/terms-of-use" target="_blank">Terms of Use</a> and <a href="https://www.westerndigital.com/legal/privacy-statement" target="_blank">Privacy Statement</a>.  All example scripts and program snippets on this site are licensed under the <a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CCO 1.0 Universal</a> license.<br>This site is built with <a href="https://docusaurus.io/" target="_blank">Docusaurus</a>.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.18692684.js"></script>
<script src="/assets/js/main.e827f9a4.js"></script>
</body>
</html>