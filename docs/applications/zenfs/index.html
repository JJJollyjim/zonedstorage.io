<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Zoned Storage Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Zoned Storage Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0DX1KGD5E4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0DX1KGD5E4",{})</script><title data-react-helmet="true">RocksDB with ZenFS | Zoned Storage</title><meta data-react-helmet="true" property="og:url" content="https://zonedstorage.io/docs/applications/zenfs"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="RocksDB with ZenFS | Zoned Storage"><meta data-react-helmet="true" name="description" content="RocksDB is a persistent"><meta data-react-helmet="true" property="og:description" content="RocksDB is a persistent"><link data-react-helmet="true" rel="shortcut icon" href="/img/zs-logo.ico"><link data-react-helmet="true" rel="canonical" href="https://zonedstorage.io/docs/applications/zenfs"><link data-react-helmet="true" rel="alternate" href="https://zonedstorage.io/docs/applications/zenfs" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zonedstorage.io/docs/applications/zenfs" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.30532e53.css">
<link rel="preload" href="/assets/js/runtime~main.de1a87e7.js" as="script">
<link rel="preload" href="/assets/js/main.e827f9a4.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Zoned Storage</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/docs/community/support">Community</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Zoned Storage</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/introduction">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/support">Community</a></li><li class="menu__list-item"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><div class="docSidebarContainer_0YBq" role="complementary"><div class="sidebar_a3j0"><div class="menu menu--responsive thin-scrollbar menu_cyFh"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction/zoned-storage">Zoned Storage Devices</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction/smr">Shingled Magnetic Recording</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction/zns">NVMe Zoned Namespaces (ZNS) SSDs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/prerequisites">System Prerequisites</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/nullblk">Zoned Block Device Emulation with nullblk</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/smr-disk">Getting Started with SMR Hard-Disks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/smr-emulation">Getting Started with Emulated SMR Hard-Disks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/zns-emulation">Getting Started with Emulated NVMe ZNS Devices</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Linux Kernel Support</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/overview">Linux Kernel Zoned Storage Support</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/config">Kernel Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/zbd-api">Zoned Block Device User Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/sched">Write Ordering Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/part">Zoned Block Device Partition Support</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/dm">Device Mapper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/fs">File Systems</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/applications">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/applications/percona-server">Percona Server for MySQL</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/applications/zenfs">RocksDB with ZenFS</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tools and Libraries</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/util-linux">Linux System Utilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/zns">ZNS Tools</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/sg3utils">SCSI Generic Utilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/libzbc">libzbc User Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/libzbd">libzbd User Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/libnvme">libnvme User Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/tcmu-runner">tcmu-runner ZBC Disk Emulation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/qemu">QEMU and KVM</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">System Compliance Tests</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tests">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tests/zbc-tests">ZBC/ZAC Compliance Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tests/blktests">Kernel Block Layer Tests</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/distributions/linux">Linux Distributions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/benchmarking/benchmark">Benchmarking Zoned Block Devices</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq/faq">Frequently Asked Questions</a></li></ul></div></div></div><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">RocksDB with ZenFS</h1></header><div class="markdown"><p><em><a href="https://rocksdb.org/" target="_blank" rel="noopener noreferrer">RocksDB</a></em> is a persistent
key-value store for fast storage devices. It is implemented using a <a href="https://en.wikipedia.org/wiki/Log-structured_merge-tree" target="_blank" rel="noopener noreferrer">
Log-Structured Merge-Tree (LSM-tree)</a> data structure.  It is simlilar to
LSM-tree based key-value engine implementations: values are stored in tables
that are sorted in increasing key order. Tables are sequentially written and
never modified.  This basic principle of the LSM-tree data structure makes it
possible to support zoned block devices.</p><p>The storage plugin architecture of RocksDB makes it possible to accommodate
different storage backends. More to the point, ZenFS implements support for
zoned block devices and is integrated into RocksDB.</p><p><em><a href="https://github.com/westerndigitalcorporation/zenfs" target="_blank" rel="noopener noreferrer">
ZenFS</a></em> is a file system plugin for <em>RocksDB</em> that uses the <em>RocksDB</em>
FileSystem [sic] interface to place files into zones on a raw zoned block
device. By separating files into zones and utilizing &quot;write lifetime hints&quot;
(WLTH) to co-locate data of similar lifetimes, <em>ZenFS</em> can reduce system write
amplification as compared to regular file systems on conventional block
devices. <em>ZenFS</em> ensures that there is no background garbage collection in the
file system or on the device, which improves performance in terms of
throughput, tail latencies and endurance.</p><p><em>ZenFS</em> can store multiple files in a single zone by using an extent allocation
scheme. A file can be composed of one or more extents and all the extents that
compose that file can be stored in the same zone (or in different zones) of the
device. An extent never spans multiple zones. When all file extents in a zone
are invalidated, the zone can be reset and then reused to store new file
extents.</p><p>ZenFS places file extents into zones based on write lifetime hints (WLTH)
provided by RocksDB library. ZenFS always attempts to place file extents
together in the same zones when they have similar WLTH.</p><p>In <em>ZenFS</em>, data garbage collection is performed only by RocksDB when it
initiates the LSM-tree table compaction process. No garbage collection is
executed by ZenFS and no garbage collection is executed by the ZNS device
controller.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Further information is available in
the <a href="https://www.usenix.org/conference/atc21/presentation/bjorling" target="_blank" rel="noopener noreferrer"> ZNS: Avoiding the Block Interface Tax for Flash-based SSDs </a>
USENIX ATC 2021 article.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="getting-started"></a>Getting Started<a class="hash-link" href="#getting-started" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h3><p><em>ZenFS</em> requires Linux kernel version 5.9 or newer. The kernel used must
be configured with
<a href="/docs/linux/config">zoned block device support enabled</a>.</p><p><em>ZenFS</em> uses the <a href="/docs/tools/libzbd"><em>libzbd</em></a> library. The latest version
of this library must be compiled and installed prior to building and
installing <em>ZenFS</em>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="building-and-installing-zenfs"></a>Building and Installing ZenFS<a class="hash-link" href="#building-and-installing-zenfs" title="Direct link to heading">#</a></h3><p><em>ZenFS</em> is embedded into RocksDB. It is available as a submodule in RocksDB
and must be explicitly enabled when compiling RocksDB.</p><p>Instructions that explain how to compile and install RocksDB with <em>ZenFS</em> are
maintained in the <em>ZenFS</em> project <a href="https://github.com/westerndigitalcorporation/zenfs/blob/master/README.md" target="_blank" rel="noopener noreferrer"> README file</a>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Remember to set the block device IO scheduler to &quot;deadline&quot; to prevent write
operations from being reordered. This can be done automatically on system
boot using a <a href="/docs/linux/sched"><em>udev</em> rule</a>.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="zenfs-command-line"></a>ZenFS Command Line<a class="hash-link" href="#zenfs-command-line" title="Direct link to heading">#</a></h3><p><em>ZenFS</em> provides a command line utility called <em>zenfs</em>. This utility is used to
format the zoned device to create a new filesystem, to list the files, and to
back up and restore the filesystem.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="create-a-zenfs-file-system"></a>Create a ZenFS file system<a class="hash-link" href="#create-a-zenfs-file-system" title="Direct link to heading">#</a></h4><p>To create or format a zoned block device (e.g., NVMe ZNS device <code>/dev/nvme0n1</code>),
use the following command:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">zenfs mkfs --zbd=nvme0n1 --aux_path=/tmp/zone-aux --force</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># Output example</span></div><div class="token-line" style="color:#393A34"><span class="token plain">ZenFS file system created. Free space: 220246 MB</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="list-files-within-a-zenfs-file-system"></a>List files within a ZenFS file system<a class="hash-link" href="#list-files-within-a-zenfs-file-system" title="Direct link to heading">#</a></h4><p>After the zoned block device has been formatted, <em>RocksDB</em> manages its files
through <em>ZenFS</em>. To list the files present on the zoned block device, use the
following command:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">zenfs list --zbd=nvme0n1 --path=rocksdbtest/dbbench</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># Output example:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">           0    Jul 20 2021 18:13:52            LOCK</span></div><div class="token-line" style="color:#393A34"><span class="token plain">       66979    Jul 20 2021 18:14:01            LOG</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    26961453    Jul 20 2021 18:13:55            000014.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    26961524    Jul 20 2021 18:13:55            000015.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    26961904    Jul 20 2021 18:13:55            000016.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    26963148    Jul 20 2021 18:13:55            000017.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   102734225    Jul 20 2021 18:13:56            000019.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    26962608    Jul 20 2021 18:13:55            000020.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    26961566    Jul 20 2021 18:13:56            000021.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    26963214    Jul 20 2021 18:13:56            000022.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    26963380    Jul 20 2021 18:13:57            000023.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   102594916    Jul 20 2021 18:13:58            000025.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    26546055    Jul 20 2021 18:13:59            000026.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   102540090    Jul 20 2021 18:14:00            000028.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   190808702    Jul 20 2021 18:14:01            000029.log</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   102826791    Jul 20 2021 18:14:00            000030.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          16    Jul 20 2021 18:13:52            CURRENT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          37    Jul 20 2021 18:13:52            IDENTITY</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        1586    Jul 20 2021 18:14:01            MANIFEST-000004</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        6178    Jul 20 2021 18:13:52            OPTIONS-000007</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="back-up-files-within-a-zenfs-file-system"></a>Back up files within a ZenFS file system<a class="hash-link" href="#back-up-files-within-a-zenfs-file-system" title="Direct link to heading">#</a></h4><p>To back up all table and metadata files within a <em>ZenFS</em> file system to a local
filesystem, use the following command:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">zenfs backup --zbd=nvme0n1 --path=/tmp/backup</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># Output example</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/LOCK</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/LOG</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000014.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000015.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000016.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000017.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000019.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000020.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000021.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000022.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000023.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000025.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000026.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000028.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000029.log</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/000030.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/CURRENT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/IDENTITY</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/MANIFEST-000004</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rocksdbtest/dbbench/OPTIONS-000007</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="restore-files-within-a-zenfs-file-system"></a>Restore files within a ZenFS file system<a class="hash-link" href="#restore-files-within-a-zenfs-file-system" title="Direct link to heading">#</a></h4><p>To restore files from a previous backup, use the following command:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">zenfs restore --zbd=nvme0n1 --path=/tmp/backup/rocksdbtest/dbbench/ \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        --restore_path=rocksdbtest/dbbench</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># Output example</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/CURRENT</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/LOCK</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000015.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000022.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/LOG</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/MANIFEST-000004</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000023.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000028.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000025.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000030.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/IDENTITY</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/OPTIONS-000007</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000020.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000019.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000016.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000014.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000026.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000029.log</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000021.sst</span></div><div class="token-line" style="color:#393A34"><span class="token plain">/tmp/backup/rocksdbtest/dbbench/000017.sst</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="benchmarking"></a>Benchmarking<a class="hash-link" href="#benchmarking" title="Direct link to heading">#</a></h3><p><em>RocksDB</em> provides the <em>db_bench</em> utility to test and benchmark the performance
of a device. The following command provides an example of <em>db_bench</em> execution,
using a zoned block device that has been formatted with <em>ZenFS</em>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">db_bench --fs_uri=zenfs://dev:nvme0n1 --benchmarks=fillrandom \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">       --use_direct_reads --key_size=16 --value_size=800 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">       --target_file_size_base=2147483648 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">       --use_direct_io_for_flush_and_compaction \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">       --max_bytes_for_level_multiplier=4 --write_buffer_size=2147483648 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">       --target_file_size_multiplier=1 --num=1000000 --threads=2 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">       --max_background_jobs=4</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># Output example</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Initializing RocksDB Options from the specified file</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Initializing RocksDB Options from command-line flags</span></div><div class="token-line" style="color:#393A34"><span class="token plain">RocksDB:    version 6.21</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Date:       Tue Jul 20 20:24:56 2021</span></div><div class="token-line" style="color:#393A34"><span class="token plain">CPU:        32 * AMD EPYC 7302P 16-Core Processor</span></div><div class="token-line" style="color:#393A34"><span class="token plain">CPUCache:   512 KB</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Keys:       16 bytes each (+ 0 bytes user-defined timestamp)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Values:     800 bytes each (400 bytes after compression)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Entries:    1000000</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Prefix:    0 bytes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Keys per prefix:    0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">RawSize:    778.2 MB (estimated)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">FileSize:   396.7 MB (estimated)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Write rate: 0 bytes/second</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Read rate: 0 ops/second</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Compression: Snappy</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Compression sampling rate: 0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Memtablerep: skip_list</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Perf Level: 1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Initializing RocksDB Options from the specified file</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Initializing RocksDB Options from command-line flags</span></div><div class="token-line" style="color:#393A34"><span class="token plain">DB path: [rocksdbtest/dbbench]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fillrandom   :      10.447 micros/op 191441 ops/sec;  149.0 MB/s</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/applications/percona-server"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Percona Server for MySQL</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/tools"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tools and Libraries Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-started" class="table-of-contents__link">Getting Started</a><ul><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#building-and-installing-zenfs" class="table-of-contents__link">Building and Installing ZenFS</a></li><li><a href="#zenfs-command-line" class="table-of-contents__link">ZenFS Command Line</a></li><li><a href="#benchmarking" class="table-of-contents__link">Benchmarking</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/zoned-storage">Introduction to Zoned Storage</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started with Zoned Storage</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://app.element.io/#/room/#zonedstorage-general:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix</a></li><li class="footer__item"><a href="https://join.slack.com/t/zonedstorage/shared_invite/zt-uyfut5xe-nKajp9YRnEWqiD4X6RkTFw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://webchat.oftc.net/?channels=zonedstorage" target="_blank" rel="noopener noreferrer" class="footer__link-item">IRC @ OFTC</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/westerndigitalcorporation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Organization</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Western Digital
	Corporation or its affiliates. All rights reserved.<br> By using this site, you agree to the <a href="https://www.westerndigital.com/legal/terms-of-use" target="_blank">Terms of Use</a> and <a href="https://www.westerndigital.com/legal/privacy-statement" target="_blank">Privacy Statement</a>.  All example scripts and program snippets on this site are licensed under the <a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CCO 1.0 Universal</a> license.<br>This site is built with <a href="https://docusaurus.io/" target="_blank">Docusaurus</a>.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.de1a87e7.js"></script>
<script src="/assets/js/main.e827f9a4.js"></script>
</body>
</html>