<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Zoned Storage Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Zoned Storage Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0DX1KGD5E4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0DX1KGD5E4",{})</script><title data-react-helmet="true">Benchmarking Zoned Block Devices | Zoned Storage</title><meta data-react-helmet="true" property="og:url" content="https://zonedstorage.io/docs/benchmarking/benchmark"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Benchmarking Zoned Block Devices | Zoned Storage"><meta data-react-helmet="true" name="description" content="The Flexible I/O Tester (fio) was originally written as a test tool for the"><meta data-react-helmet="true" property="og:description" content="The Flexible I/O Tester (fio) was originally written as a test tool for the"><link data-react-helmet="true" rel="shortcut icon" href="/img/zs-logo.ico"><link data-react-helmet="true" rel="canonical" href="https://zonedstorage.io/docs/benchmarking/benchmark"><link data-react-helmet="true" rel="alternate" href="https://zonedstorage.io/docs/benchmarking/benchmark" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zonedstorage.io/docs/benchmarking/benchmark" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.30532e53.css">
<link rel="preload" href="/assets/js/runtime~main.97f7f774.js" as="script">
<link rel="preload" href="/assets/js/main.e827f9a4.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Zoned Storage</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/docs/community/support">Community</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Zoned Storage</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/introduction">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/support">Community</a></li><li class="menu__list-item"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><div class="docSidebarContainer_0YBq" role="complementary"><div class="sidebar_a3j0"><div class="menu menu--responsive thin-scrollbar menu_cyFh"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction/zoned-storage">Zoned Storage Devices</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction/smr">Shingled Magnetic Recording</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction/zns">NVMe Zoned Namespaces (ZNS) SSDs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/prerequisites">System Prerequisites</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/nullblk">Zoned Block Device Emulation with nullblk</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/smr-disk">Getting Started with SMR Hard-Disks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/smr-emulation">Getting Started with Emulated SMR Hard-Disks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/zns-emulation">Getting Started with Emulated NVMe ZNS Devices</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Linux Kernel Support</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/overview">Linux Kernel Zoned Storage Support</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/config">Kernel Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/zbd-api">Zoned Block Device User Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/sched">Write Ordering Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/part">Zoned Block Device Partition Support</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/dm">Device Mapper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/linux/fs">File Systems</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/applications">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/applications/percona-server">Percona Server for MySQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/applications/zenfs">RocksDB with ZenFS</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tools and Libraries</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/util-linux">Linux System Utilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/zns">ZNS Tools</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/sg3utils">SCSI Generic Utilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/libzbc">libzbc User Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/libzbd">libzbd User Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/libnvme">libnvme User Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/tcmu-runner">tcmu-runner ZBC Disk Emulation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools/qemu">QEMU and KVM</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">System Compliance Tests</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tests">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tests/zbc-tests">ZBC/ZAC Compliance Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tests/blktests">Kernel Block Layer Tests</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/distributions/linux">Linux Distributions</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/benchmarking/benchmark">Benchmarking Zoned Block Devices</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq/faq">Frequently Asked Questions</a></li></ul></div></div></div><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Benchmarking Zoned Block Devices</h1></header><div class="markdown"><p>The <em>Flexible I/O Tester (fio)</em> was originally written as a test tool for the
kernel block I/O stack. Over the years, <em>fio</em> however gained many features and
detailed performance statistics output that turned this tool into a standard
benchmark application for storage devices.</p><p><em>fio</em> source code is available on <a href="https://github.com/axboe/fio" target="_blank" rel="noopener noreferrer">GitHub</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="fio-zoned-block-device-support"></a>fio Zoned Block Device Support<a class="hash-link" href="#fio-zoned-block-device-support" title="Direct link to heading">#</a></h2><p>Support for zoned block devices was added to <em>fio</em> with version 3.9. All
previous versions do not provide guarantees for write command ordering with
host managed zoned block devices. Executing workloads is still possible, but
requires writing complex <em>fio</em> scripts.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="command-line-options"></a>Command Line Options<a class="hash-link" href="#command-line-options" title="Direct link to heading">#</a></h3><p>Changes to <em>fio</em> to support zoned block devices include several new options
allowing a user to control zoned block device compliant workloads. <em>fio</em>
already implemented the option <code>--zonemode</code> which allows defining workloads
operating on disjoint ranges of blocks. This option was reused to define the new
<em>zbd</em> zone mode.</p><p>When the <em>zbd</em> zone mode is used by an <em>fio</em> job, the <code>--zonerange</code> option is
ignored and the <code>--zonesize</code> option is automatically set to the device zone
size. Furthermore, the behavior of read and write commands is modified as
follows.</p><ul><li><p>Read and write commands are split when a zone boundary is crossed.</p></li><li><p>For sequential writes, the write stream is always started from a zone write
pointer position. If the next zone to be written is not empty, the write
stream &quot;jumps&quot; to that zone write pointer and resumes.</p></li><li><p>For random write workloads, write commands are always issued at the write
pointer position of the target zone of the write command.</p></li><li><p>Any write command targeting a sequential zone that is full (entirely written)
will trigger a reset of the zone write pointer before issuing the write I/O.</p></li><li><p>By default, all read commands always target written sectors, that is, sectors
between the start sector and the write pointer position of sequential write
zones. This behavior can be disabled, allowing read commands to be issued to
any sector, using the new option <code>read_beyond_wp</code>.</p></li></ul><p>Additionally, finer control over the workload operation can be added with the
following new options.</p><ul><li><p><strong>--max_open_zones</strong> This option limits the number of zones that are being
written by a workload. With this option, a random write workload cannot issue
write commands targeting more zones than the limit set. Once a zone that is
being written becomes full, another zone is chosen and writes are allowed to
target the zone, resulting in a constant number of zones being written always
at most equal to the <code>max_open_zones</code> limit.</p></li><li><p><strong>--zone_reset_threshold and --zone_reset_frequency</strong> These two options allow
a user to emulate the execution of zone reset commands being issued by an
application.</p></li></ul><p>In addition to these options, the <em>zbd</em> zone mode automatically enables job
synchronization to ensure that a workload spanning multiple threads or processes
can concurrently execute write I/Os targeting the same zone.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="restrictions"></a>Restrictions<a class="hash-link" href="#restrictions" title="Direct link to heading">#</a></h3><p>As discussed in the <a href="/docs/linux/overview#zbd-support-restrictions">kernel support
document</a>, using
direct write I/O is mandatory for zoned block devices. The <em>zbd</em> zone mode,
when enabled, enforces this requirement by checking that the option
<code>--direct=1</code> is specified for any job executing write I/Os.</p><p>The <code>--offset</code> and <code>--size</code> options must specify values that are aligned to the
device zone size.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="zonemodezbd-examples"></a><em>zonemode=zbd</em> Examples<a class="hash-link" href="#zonemodezbd-examples" title="Direct link to heading">#</a></h2><p>This section provides various examples showing how to use <em>fio</em> new <em>zbd</em> zone
mode. In all examples, a 15TB ZAC host managed SATA disk is used. The disk zone
size is 256 MiB. The disk has 524 conventional zones starting at offset 0. The
first sequential write required zone of the disk starts at sector 274726912
(512 B sector unit), that is, at the byte offset 140660178944.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="sequential-write-workload"></a>Sequential Write Workload<a class="hash-link" href="#sequential-write-workload" title="Direct link to heading">#</a></h3><p>The following command sequentially writes the first 4 sequential zones of the
disk using the <em>libaio</em> I/O engine with a queue depth of 8.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 --zonemode=zbd \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=140660178944 --size=1G \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --ioengine=libaio --iodepth=8 --rw=write --bs=256K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (g=0): rw=write, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 1 process</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Jobs: 1 (f=1): [W(1)][100.0%][w=239MiB/s][w=955 IOPS][eta 00m:00s]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (groupid=0, jobs=1): err= 0: pid=4124: Fri May 24 11:49:18 2019</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  write: IOPS=938, BW=235MiB/s (246MB/s)(1024MiB/4365msec); 0 zone resets</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    slat (nsec): min=5930, max=39068, avg=9729.06, stdev=2048.99</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=783, max=55846, avg=8511.40, stdev=4079.36</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=809, max=55854, avg=8521.19, stdev=4079.36</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[ 3884],  5.00th=[ 7701], 10.00th=[ 8094], 20.00th=[ 8225],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[ 8225], 40.00th=[ 8225], 50.00th=[ 8225], 60.00th=[ 8291],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[ 8356], 80.00th=[ 8356], 90.00th=[ 8356], 95.00th=[ 8356],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[30540], 99.50th=[45351], 99.90th=[55837], 99.95th=[55837],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[55837]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   bw (  KiB/s): min=224830, max=249357, per=99.49%, avg=239009.50, stdev=9032.95, samples=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=  878, max=  974, avg=933.50, stdev=35.36, samples=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 1000=0.02%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 4=2.91%, 10=95.70%, 20=0.20%, 50=0.78%, 100=0.39%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.73%, sys=0.64%, ctx=1045, majf=0, minf=11</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=99.8%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.1%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=0,4096,0,0 short=0,0,0,0 dropped=0,0,0,0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  WRITE: bw=235MiB/s (246MB/s), 235MiB/s-235MiB/s (246MB/s-246MB/s), io=1024MiB (1074MB), run=4365-4365msec</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=0/984, merge=0/2943, ticks=0/8365, in_queue=7383, util=24.13%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The first four sequential write required zones of the disk are now full.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones /dev/sdd</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sdd:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA xxxx xxxxxxxxxxx xxxx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Zoned block device interface, Host-managed zone model</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    55880 zones from 0, reporting option 0x00</span></div><div class="token-line" style="color:#393A34"><span class="token plain">55880 / 55880 zones:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">one 00524: type 0x2 (Sequential-write-required), cond 0xe {==(Full)==}, reset recommended 0, non_seq 0, sector 274726912, 524288 sectors, wp 275251200</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00525: type 0x2 (Sequential-write-required), cond 0xe {==(Full)==}, reset recommended 0, non_seq 0, sector 275251200, 524288 sectors, wp 275775488</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00526: type 0x2 (Sequential-write-required), cond 0xe {==(Full)==}, reset recommended 0, non_seq 0, sector 275775488, 524288 sectors, wp 276299776</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00527: type 0x2 (Sequential-write-required), cond 0xe {==(Full)==}, reset recommended 0, non_seq 0, sector 276299776, 524288 sectors, wp 276824064</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zone 00528: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 276824064, 524288 sectors, wp 276824064</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>With the disk in this state, executing the same command again without the <em>zbd</em>
zone mode enabled, <em>fio</em> will attempt to write to full zones, resulting in I/O
errors.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=140660178944 --size=1G \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --ioengine=libaio --iodepth=8 --rw=write --bs=256K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (g=0): rw=write, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 1 process</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio: {==io_u error on file /dev/sdd: Remote I/O error==}: write offset=140660178944, buflen=262144</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio: pid=4206, err=121/file:io_u.c:1791, func=io_u error, error=Remote I/O error</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (groupid=0, jobs=1): err=121 (file:io_u.c:1791, func=io_u error, error=Remote I/O error): pid=4206: Fri May 24 12:34:27 2019</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=1.22%, sys=0.00%, ctx=3, majf=0, minf=16</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=12.5%, 2=25.0%, 4=50.0%, 8=12.5%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=0,8,0,0 short=0,0,0,0 dropped=0,0,0,0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=48/3, merge=0/5, ticks=13/35, in_queue=32, util=5.39%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>With the <em>zbd</em> zone mode enabled, the same command executed again with the zones
full succeeds.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 --zonemode=zbd \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=140660178944 --size=1G \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --ioengine=libaio --iodepth=8 --rw=write --bs=256K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (g=0): rw=write, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 1 process</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Jobs: 1 (f=1): [W(1)][100.0%][w=243MiB/s][w=973 IOPS][eta 00m:00s]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (groupid=0, jobs=1): err= 0: pid=4220: Fri May 24 12:37:29 2019</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  write: IOPS=949, BW=237MiB/s (249MB/s)(1024MiB/4316msec); {==4 zone resets==}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    slat (nsec): min=5937, max=40055, avg=9651.92, stdev=2104.34</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=795, max=36562, avg=8243.26, stdev=2031.55</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=818, max=36571, avg=8252.96, stdev=2031.50</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[ 3884],  5.00th=[ 7701], 10.00th=[ 8160], 20.00th=[ 8225],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[ 8225], 40.00th=[ 8225], 50.00th=[ 8225], 60.00th=[ 8291],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[ 8291], 80.00th=[ 8356], 90.00th=[ 8356], 95.00th=[ 8356],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[10159], 99.50th=[27919], 99.90th=[33817], 99.95th=[36439],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[36439]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   bw (  KiB/s): min=234538, max=249357, per=99.93%, avg=242777.88, stdev=5032.30, samples=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=  916, max=  974, avg=948.25, stdev=19.70, samples=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 1000=0.02%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=0.07%, 4=2.78%, 10=96.02%, 20=0.51%, 50=0.59%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=1.27%, sys=0.67%, ctx=1051, majf=0, minf=12</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=0.1%, 2=0.2%, 4=0.4%, 8=99.3%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.1%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=0,4096,0,0 short=0,0,0,0 dropped=0,0,0,0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  WRITE: bw=237MiB/s (249MB/s), 237MiB/s-237MiB/s (249MB/s-249MB/s), io=1024MiB (1074MB), run=4316-4316msec</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=4/998, merge=0/2985, ticks=81/8205, in_queue=7286, util=24.38%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Note that <em>fio</em> output in this case indicates the number of zones that were
reset prior to writing.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="sequential-read-workload"></a>Sequential Read Workload<a class="hash-link" href="#sequential-read-workload" title="Direct link to heading">#</a></h3><p>With the disk previous state preserved (with the first four sequential write
zones full), the previous command can be changed to read operations targeting
the written zones.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 --zonemode=zbd \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=140660178944 --size=1G \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --ioengine=libaio --iodepth=8 --rw=read --bs=256K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (g=0): rw=read, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 1 process</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Jobs: 1 (f=1): [R(1)][100.0%][r=243MiB/s][r=970 IOPS][eta 00m:00s]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (groupid=0, jobs=1): err= 0: pid=4236: Fri May 24 12:40:18 2019</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  read: IOPS=951, BW=238MiB/s (249MB/s)(1024MiB/4304msec)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    slat (usec): min=5, max=148, avg= 6.62, stdev= 5.68</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=976, max=39536, avg=8394.44, stdev=1933.57</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=1125, max=39543, avg=8401.12, stdev=1934.43</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[ 6390],  5.00th=[ 6718], 10.00th=[ 6915], 20.00th=[ 7439],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[ 8094], 40.00th=[ 8291], 50.00th=[ 8356], 60.00th=[ 8356],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[ 8356], 80.00th=[ 8356], 90.00th=[ 9765], 95.00th=[10290],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[14615], 99.50th=[25560], 99.90th=[29492], 99.95th=[39584],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[39584]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   bw (  KiB/s): min=223808, max=249868, per=99.57%, avg=242586.38, stdev=8265.29, samples=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=  874, max=  976, avg=947.50, stdev=32.35, samples=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 1000=0.02%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=0.05%, 4=0.05%, 10=92.53%, 20=6.81%, 50=0.54%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.40%, sys=0.72%, ctx=4113, majf=0, minf=522</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=99.8%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.1%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=4096,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   READ: bw=238MiB/s (249MB/s), 238MiB/s-238MiB/s (249MB/s-249MB/s), io=1024MiB (1074MB), run=4304-4304msec</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=4031/0, merge=0/0, ticks=33836/0, in_queue=29809, util=57.74%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>If the zones are reset before executing this command, no read I/O will be
executed as <em>fio</em> will be enable to find zones with written sectors.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># blkzone reset -o 274726912 -l 2097152 /dev/sdd</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 --zonemode=zbd \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=140660178944 --size=1G \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --ioengine=libaio --iodepth=8 --rw=read --bs=256K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (g=0): rw=read, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 1 process</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=0/0, merge=0/0, ticks=0/0, in_queue=0, util=0.00%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Forcing the execution of read I/Os targeting empty zones can be done using the
<code>--read_beyond_wp</code> option.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 --zonemode=zbd \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=140660178944 --size=1G {==--read_beyond_wp=1==} \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --ioengine=libaio --iodepth=8 --rw=read --bs=256K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (g=0): rw=read, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 1 process</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Jobs: 1 (f=1): [R(1)][-.-%][r=353MiB/s][r=1412 IOPS][eta 00m:00s]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (groupid=0, jobs=1): err= 0: pid=4322: Fri May 24 12:46:32 2019</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  read: IOPS=1411, BW=353MiB/s (370MB/s)(1024MiB/2901msec)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    slat (usec): min=5, max=147, avg= 6.50, stdev= 5.72</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=1978, max=8845, avg=5654.86, stdev=112.79</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=2126, max=8851, avg=5661.41, stdev=111.86</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[ 5604],  5.00th=[ 5604], 10.00th=[ 5604], 20.00th=[ 5669],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[ 5669], 40.00th=[ 5669], 50.00th=[ 5669], 60.00th=[ 5669],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[ 5669], 80.00th=[ 5669], 90.00th=[ 5669], 95.00th=[ 5735],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[ 5735], 99.50th=[ 5800], 99.90th=[ 7177], 99.95th=[ 7963],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[ 8848]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   bw (  KiB/s): min=360239, max=361261, per=99.81%, avg=360750.00, stdev=361.33, samples=5</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   iops        : min= 1407, max= 1411, avg=1409.00, stdev= 1.41, samples=5</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=0.02%, 10=99.98%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.24%, sys=1.34%, ctx=4108, majf=0, minf=522</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=99.8%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.1%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=4096,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=8</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   READ: bw=353MiB/s (370MB/s), 353MiB/s-353MiB/s (370MB/s-370MB/s), io=1024MiB (1074MB), run=2901-2901msec</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=3869/0, merge=0/0, ticks=21868/0, in_queue=18002, util=81.20%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The higher IOPS performance observed with this test compared to the previous one
(i.e. IOPS=1411 vs. IOPS=951) results from the disk not physically executing any
media access as there is no data to read (no written sectors). The disks returns
a fill pattern as data without seeking to the sectors specified by the read
commands.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="random-read-and-write-workloads"></a>Random Read and Write Workloads<a class="hash-link" href="#random-read-and-write-workloads" title="Direct link to heading">#</a></h3><p>The following command randomly write sequential write zones of the disk using 4
jobs, each job operating at a queue depth of 4 (overall queue depth of 16 for
the disk). The run time is set to 30 seconds.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 --zonemode=zbd \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=140660178944 --numjobs=4 --group_reporting=1 --runtime=30 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --ioengine=libaio --iodepth=4 --rw=randwrite --bs=256K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (g=0): rw=randwrite, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=4</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 4 processes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Jobs: 4 (f=4): [w(4)][100.0%][w=33.0MiB/s][w=132 IOPS][eta 00m:00s]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (groupid=0, jobs=4): err= 0: pid=4425: Fri May 24 12:58:43 2019</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  write: IOPS=160, BW=40.2MiB/s (42.2MB/s)(1209MiB/30064msec); 0 zone resets</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    slat (nsec): min=7815, max=75710, avg=12304.05, stdev=3091.33</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=1410, max=221285, avg=98856.71, stdev=29971.24</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=1435, max=221295, avg=98869.07, stdev=29970.46</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (msec):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[   12],  5.00th=[   24], 10.00th=[   75], 20.00th=[   84],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[   89], 40.00th=[   94], 50.00th=[   99], 60.00th=[  105],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[  110], 80.00th=[  117], 90.00th=[  128], 95.00th=[  138],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[  194], 99.50th=[  203], 99.90th=[  218], 99.95th=[  220],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[  222]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   bw (  KiB/s): min=27092, max=138608, per=99.80%, avg=41096.13, stdev=3423.45, samples=240</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=  103, max=  540, avg=159.05, stdev=13.38, samples=240</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=0.02%, 4=0.06%, 10=0.43%, 20=3.74%, 50=1.26%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 100=47.27%, 250=47.21%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.09%, sys=0.15%, ctx=84537, majf=0, minf=261</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=0.1%, 2=0.2%, 4=99.8%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=0,4836,0,0 short=0,0,0,0 dropped=0,0,0,0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=4</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  WRITE: bw=40.2MiB/s (42.2MB/s), 40.2MiB/s-40.2MiB/s (42.2MB/s-42.2MB/s), io=1209MiB (1268MB), run=30064-30064msec</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=0/4807, merge=0/0, ticks=0/474905, in_queue=470163, util=9.89%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p><em>zbc_report_zones</em> can be used to explore the state of the disk at the end of
this workload execution.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones -ro full -n /dev/sdd</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sdd:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA xxxx xxxxxxxxxxx xxxx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Zoned block device interface, Host-managed zone model</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    0 zone from 0, reporting option 0x05</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones -ro closed -n /dev/sdd</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sdd:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA xxxx xxxxxxxxxxx xxxx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Zoned block device interface, Host-managed zone model</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    4498 zones from 0, reporting option 0x04</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones -ro imp_open -n /dev/sdd</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sdd:</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA xxxx xxxxxxxxxxx xxxx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Zoned block device interface, Host-managed zone model</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    128 zones from 0, reporting option 0x02</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>This indicates that 4498+128=4626 zones were written to, with none of the
sequential write zones fully written (no full zone). Switching the operation
mode to read, the sectors written in this last run can be randomly read.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 --zonemode=zbd \                </span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=140660178944 --numjobs=4 --group_reporting=1 --runtime=30 \      </span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --ioengine=libaio --iodepth=4 --rw=randread --bs=256K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 4 processes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Jobs: 4 (f=4): [r(4)][0.0%][r=31.0MiB/s][r=124 IOPS][eta 23d:02h:02m:24s]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (groupid=0, jobs=4): err= 0: pid=4494: Fri May 24 13:24:08 2019</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  read: IOPS=118, BW=29.7MiB/s (31.1MB/s)(894MiB/30156msec)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    slat (usec): min=6, max=183, avg= 7.86, stdev= 8.75</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=1252, max=1537.8k, avg=133931.63, stdev=123584.49</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=1260, max=1537.8k, avg=133939.56, stdev=123584.42</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (msec):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[    8],  5.00th=[   16], 10.00th=[   20], 20.00th=[   35],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[   53], 40.00th=[   72], 50.00th=[   96], 60.00th=[  127],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[  169], 80.00th=[  218], 90.00th=[  296], 95.00th=[  368],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[  558], 99.50th=[  625], 99.90th=[  869], 99.95th=[  919],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[ 1536]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   bw (  KiB/s): min=15855, max=50152, per=100.00%, avg=30364.05, stdev=1762.17, samples=240</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=   60, max=  195, avg=117.22, stdev= 6.92, samples=240</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=0.22%, 4=0.06%, 10=1.40%, 20=8.44%, 50=18.26%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 100=23.15%, 250=33.30%, 500=13.47%, 750=1.51%, 1000=0.17%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.06%, sys=0.12%, ctx=82815, majf=0, minf=1281</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=0.1%, 2=0.2%, 4=99.7%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=3577,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=4</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   READ: bw=29.7MiB/s (31.1MB/s), 29.7MiB/s-29.7MiB/s (31.1MB/s-31.1MB/s), io=894MiB (938MB), run=30156-30156msec</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=3565/0, merge=0/0, ticks=475774/0, in_queue=472274, util=11.93%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Resetting all sequential write zones of the disk and executing again the random
read workload leads to similar results as for the previous <a href="#sequential-read-workload">sequential read
workload</a> case, that is, no read I/O is executed.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># blkzone reset -o 274726912 /dev/sdd</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 --zonemode=zbd \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=140660178944 --numjobs=4 --group_reporting=1 --runtime=30 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --ioengine=libaio --iodepth=4 --rw=randread --bs=256K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 4 processes</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=0/0, merge=0/0, ticks=0/0, in_queue=0, util=0.00%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Changing the range to be read to include the conventional zones of the disk
will result in read I/Os being executed.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 --zonemode=zbd \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=0 --size=140660178944 --numjobs=4 --group_reporting=1 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --runtime=30 --ioengine=libaio --iodepth=4 --rw=randread --bs=256K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (g=0): rw=randread, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=4</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 4 processes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Jobs: 4 (f=4): [r(4)][100.0%][r=58.0MiB/s][r=232 IOPS][eta 00m:00s]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (groupid=0, jobs=4): err= 0: pid=4570: Fri May 24 13:35:15 2019</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  read: IOPS=215, BW=53.8MiB/s (56.4MB/s)(1617MiB/30079msec)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    slat (usec): min=6, max=143, avg= 7.29, stdev= 6.22</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=1065, max=959229, avg=74313.80, stdev=83291.27</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=1072, max=959237, avg=74321.15, stdev=83291.39</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (msec):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[    8],  5.00th=[    9], 10.00th=[   12], 20.00th=[   17],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[   24], 40.00th=[   34], 50.00th=[   47], 60.00th=[   62],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[   82], 80.00th=[  113], 90.00th=[  174], 95.00th=[  239],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[  409], 99.50th=[  472], 99.90th=[  634], 99.95th=[  651],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[  961]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   bw (  KiB/s): min=27136, max=81920, per=99.97%, avg=55030.83, stdev=2685.56, samples=240</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=  106, max=  320, avg=214.10, stdev=10.53, samples=240</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=0.02%, 10=8.23%, 20=16.22%, 50=28.40%, 100=23.61%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 250=19.08%, 500=4.07%, 750=0.36%, 1000=0.03%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.02%, sys=0.07%, ctx=6483, majf=0, minf=1070</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=0.1%, 2=0.1%, 4=99.8%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=6468,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=4</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   READ: bw=53.8MiB/s (56.4MB/s), 53.8MiB/s-53.8MiB/s (56.4MB/s-56.4MB/s), io=1617MiB (1696MB), run=30079-30079msec</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=6452/0, merge=0/0, ticks=479006/0, in_queue=472619, util=21.62%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="direct-access-sg-io-engine"></a>Direct Access <em>sg</em> I/O Engine<a class="hash-link" href="#direct-access-sg-io-engine" title="Direct link to heading">#</a></h2><p>The SCSI generic direct access interface can also be used with the <em>zbd</em> zone
mode, as long as the block device file (<em>/dev/sdX</em>) is used to specify the disk.
The <em>zbd</em> zone mode will not be enabled if the SCSI generic node file
(<em>/dev/sgY</em>) is used to specify the disk.</p><p>The example below illustrates the use of the <em>sg</em> I/O engine with 8 jobs
executing a 64KB random write workload to sequential write zones.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># fio --name=zbc --filename=/dev/sdd --direct=1 --zonemode=zbd \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --offset=140660178944 --size=1G --numjobs=8 --group_reporting=1 \</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      --ioengine=sg --rw=randwrite --bs=64K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">...</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 8 processes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zbc: (groupid=0, jobs=8): err= 0: pid=4792: Fri May 24 14:18:52 2019</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  write: IOPS=2007, BW=125MiB/s (132MB/s)(8192MiB/65278msec); 32 zone resets</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=148, max=327494, avg=1589.26, stdev=4060.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=149, max=327497, avg=1590.55, stdev=4060.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[   848],  5.00th=[   988], 10.00th=[  1090], 20.00th=[  1172],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[  1221], 40.00th=[  1287], 50.00th=[  1369], 60.00th=[  1434],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[  1500], 80.00th=[  1631], 90.00th=[  2180], 95.00th=[  2638],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[  3064], 99.50th=[  3392], 99.90th=[ 24773], 99.95th=[ 77071],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[291505]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   bw (  KiB/s): min=39001, max=178678, per=100.00%, avg=131457.71, stdev=3143.56, samples=1015</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=  606, max= 2791, avg=2052.81, stdev=49.16, samples=1015</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 250=0.07%, 500=0.12%, 750=0.38%, 1000=4.89%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=81.56%, 4=12.76%, 10=0.05%, 20=0.06%, 50=0.05%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 100=0.03%, 250=0.02%, 500=0.01%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.14%, sys=0.20%, ctx=251460, majf=0, minf=139</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=0,131072,0,0 short=0,0,0,0 dropped=0,0,0,0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=1</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  WRITE: bw=125MiB/s (132MB/s), 125MiB/s-125MiB/s (132MB/s-132MB/s), io=8192MiB (8590MB), run=65278-65278msec</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=278/0, merge=0/0, ticks=1953/0, in_queue=1677, util=0.39%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>SCSI generic direct access bypasses the block layer I/O scheduler. For zoned
block devices, this means that the <em>deadline</em> I/O scheduler zone write locking
is enable to provide write command ordering guarantees.  However, the <em>zbd</em> mode
ensures mutual exclusion between jobs for write access to the same zone. Such
synchronization is in essence identical to zone write locking and execute all
write commands without any error.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="zone-write-streams"></a>Zone Write Streams<a class="hash-link" href="#zone-write-streams" title="Direct link to heading">#</a></h2><p>A typical zoned block device compliant application will write zones sequentially
until the zone is full, then switch to another zone and continue writing.
Multiple threads may be operating in this manner, with each thread operating on
a different zone.</p><p>Such typical behavior can be emulated using the option <code>--rw_sequencer</code>
together with a number of I/O operations specified at the end of the
<code>--rw=randwrite</code> argument. Below is an example script of 4 jobs sequentially
writing zones up to full using 512KB write operations (that is, 512 I/Os per
256 MB zone). The zones being written are chosen randomly within disjoint zone
ranges for each job. This is controlled with the <code>offset</code>, <code>size</code> and <code>rw</code>
arguments. The script file <code>streams.fio</code> achieving such workload is shown below.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">#</span></div><div class="token-line" style="color:#393A34"><span class="token plain"># streams.fio: 4 write streams</span></div><div class="token-line" style="color:#393A34"><span class="token plain">#</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[global]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">ioengine=psync</span></div><div class="token-line" style="color:#393A34"><span class="token plain">direct=1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">thread=1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">bs=512K</span></div><div class="token-line" style="color:#393A34"><span class="token plain">continue_on_error=none</span></div><div class="token-line" style="color:#393A34"><span class="token plain">filename=/dev/sdd</span></div><div class="token-line" style="color:#393A34"><span class="token plain">group_reporting=1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">zonemode=zbd</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[stream1]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">offset=140660178944</span></div><div class="token-line" style="color:#393A34"><span class="token plain">size=3714878275584</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rw=randwrite:512</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rw_sequencer=sequential</span></div><div class="token-line" style="color:#393A34"><span class="token plain">io_size=2G</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[stream2]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">offset=3855538454528</span></div><div class="token-line" style="color:#393A34"><span class="token plain">size=3714878275584</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rw=randwrite:512</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rw_sequencer=sequential</span></div><div class="token-line" style="color:#393A34"><span class="token plain">io_size=2G</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[stream3]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">offset=7570416730112</span></div><div class="token-line" style="color:#393A34"><span class="token plain">size=3714878275584</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rw=randwrite:512</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rw_sequencer=sequential</span></div><div class="token-line" style="color:#393A34"><span class="token plain">io_size=2G</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">[stream4]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">offset=11285295005696</span></div><div class="token-line" style="color:#393A34"><span class="token plain">size=3714878275584</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rw=randwrite:512</span></div><div class="token-line" style="color:#393A34"><span class="token plain">rw_sequencer=sequential</span></div><div class="token-line" style="color:#393A34"><span class="token plain">io_size=2G</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The result for this script execution is shown below.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plaintext"><div tabindex="0" class="prism-code language-plaintext codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain"># fio streams.fio</span></div><div class="token-line" style="color:#393A34"><span class="token plain">stream1: (g=0): rw=randwrite, bs=(R) 512KiB-512KiB, (W) 512KiB-512KiB, (T) 512KiB-512KiB, ioengine=psync, iodepth=1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">stream2: (g=0): rw=randwrite, bs=(R) 512KiB-512KiB, (W) 512KiB-512KiB, (T) 512KiB-512KiB, ioengine=psync, iodepth=1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">stream3: (g=0): rw=randwrite, bs=(R) 512KiB-512KiB, (W) 512KiB-512KiB, (T) 512KiB-512KiB, ioengine=psync, iodepth=1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">stream4: (g=0): rw=randwrite, bs=(R) 512KiB-512KiB, (W) 512KiB-512KiB, (T) 512KiB-512KiB, ioengine=psync, iodepth=1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">fio-3.13</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Starting 4 threads</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Jobs: 1 (f=1): [_(3),w(1)][98.3%][w=159MiB/s][w=318 IOPS][eta 00m:01s]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">stream1: (groupid=0, jobs=4): err= 0: pid=5161: Fri May 24 15:01:21 2019</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  write: IOPS=285, BW=143MiB/s (150MB/s)(8192MiB/57362msec); 0 zone resets</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=992, max=5788.2k, avg=12731.27, stdev=95315.03</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=996, max=5788.2k, avg=12742.01, stdev=95315.03</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[   1106],  5.00th=[   2024], 10.00th=[   2114],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 20.00th=[   2278], 30.00th=[   2769], 40.00th=[   3687],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 50.00th=[   3884], 60.00th=[   4047], 70.00th=[   4228],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 80.00th=[   4817], 90.00th=[   5342], 95.00th=[  50594],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[ 196084], 99.50th=[ 258999], 99.90th=[ 876610],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     | 99.95th=[2071987], 99.99th=[4731175]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   bw (  KiB/s): min= 9211, max=840925, per=100.00%, avg=185793.45, stdev=44491.80, samples=352</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=   17, max= 1642, avg=361.42, stdev=86.97, samples=352</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 1000=0.23%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=1.95%, 4=54.69%, 10=37.05%, 20=0.15%, 50=0.90%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 100=2.34%, 250=2.16%, 500=0.42%, 750=0.01%, 1000=0.01%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2000=0.04%, &gt;=2000=0.06%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.15%, sys=0.12%, ctx=16505, majf=0, minf=0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=0,16384,0,0 short=0,0,0,0 dropped=0,0,0,0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=1</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  WRITE: bw=143MiB/s (150MB/s), 143MiB/s-143MiB/s (150MB/s-150MB/s), io=8192MiB (8590MB), run=57362-57362msec</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  sdd: ios=144/16333, merge=0/0, ticks=573/208225, in_queue=192356, util=28.64%</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/distributions/linux"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Linux Distributions</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/faq/faq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Frequently Asked Questions Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#fio-zoned-block-device-support" class="table-of-contents__link">fio Zoned Block Device Support</a><ul><li><a href="#command-line-options" class="table-of-contents__link">Command Line Options</a></li><li><a href="#restrictions" class="table-of-contents__link">Restrictions</a></li></ul></li><li><a href="#zonemodezbd-examples" class="table-of-contents__link"><em>zonemode=zbd</em> Examples</a><ul><li><a href="#sequential-write-workload" class="table-of-contents__link">Sequential Write Workload</a></li><li><a href="#sequential-read-workload" class="table-of-contents__link">Sequential Read Workload</a></li><li><a href="#random-read-and-write-workloads" class="table-of-contents__link">Random Read and Write Workloads</a></li></ul></li><li><a href="#direct-access-sg-io-engine" class="table-of-contents__link">Direct Access <em>sg</em> I/O Engine</a></li><li><a href="#zone-write-streams" class="table-of-contents__link">Zone Write Streams</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/zoned-storage">Introduction to Zoned Storage</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started with Zoned Storage</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://app.element.io/#/room/#zonedstorage-general:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix</a></li><li class="footer__item"><a href="https://join.slack.com/t/zonedstorage/shared_invite/zt-uyfut5xe-nKajp9YRnEWqiD4X6RkTFw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://webchat.oftc.net/?channels=zonedstorage" target="_blank" rel="noopener noreferrer" class="footer__link-item">IRC @ OFTC</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/westerndigitalcorporation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Organization</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Western Digital
	Corporation or its affiliates. All rights reserved.<br> By using this site, you agree to the <a href="https://www.westerndigital.com/legal/terms-of-use" target="_blank">Terms of Use</a> and <a href="https://www.westerndigital.com/legal/privacy-statement" target="_blank">Privacy Statement</a>.  All example scripts and program snippets on this site are licensed under the <a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CCO 1.0 Universal</a> license.<br>This site is built with <a href="https://docusaurus.io/" target="_blank">Docusaurus</a>.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.97f7f774.js"></script>
<script src="/assets/js/main.e827f9a4.js"></script>
</body>
</html>